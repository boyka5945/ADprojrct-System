<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script>
<script src="~/Scripts/chart-colors.js"></script>

@{
    string year = (string)ViewBag.Year;
}

<input type="hidden" value="@year" name="year" id="year" />
<canvas id="myChart"> </canvas>

<script>
    var year = $('#year').val();
    var title = 'Stationery Requisition Cumulative Chart of Year ' + year;

    var labels = @Html.Raw(Json.Encode(ViewBag.XLabels));

    var lineLabel = @Html.Raw(Json.Encode(ViewBag.YLineLabel));
    var lineData = @Html.Raw(Json.Encode(ViewBag.YLineData));
    var barLabel = @Html.Raw(Json.Encode(ViewBag.YBarLabel));
    var barData = @Html.Raw(Json.Encode(ViewBag.YBarData));

    var color = Chart.helpers.color;
    var myChart = document.getElementById("myChart").getContext("2d");

    var showQtyChart = new Chart("myChart", {
        type: "bar",  
        data: {
            labels: labels,
            datasets:
            [
                {
                    type: 'line',
                    label: lineLabel,
                    yAxisID: "y-axis-2",
                    borderColor: window.chartColors.red,
                    backgroundColor: window.chartColors.red,
                    borderWidth: 2,
                    fill: false,
                    data: lineData,
                },

                {
                    type: "bar",  
                    label:barLabel,
                    yAxisID: "y-axis-1",
                    backgroundColor: window.chartColors.blue,
                    borderColor: window.chartColors.blue,
                    borderWidth: 2,
                    data: barData,
                },
            ],
        },
        options:
            {
                legend:
                {
                    display: true,
                    labels:
                    {
                        fontColor: window.chartColors.black,
                    }

                },
                title:
                {
                    display: true,
                    fontSize: 16,
                    fontStyle: 'Bold',
                    text: title,
                },
                tooltips: 
                {
                    mode: 'index',
                    intersect: true
                },
                scales:
                {
                    yAxes:
                    [{
                        id: "y-axis-1",
                        type: "linear", // only linear but allow scale type registration. This allows extensions to exist solely for log scale for instance
                        display: true,
                        position: "left",
                        scaleLabel:
                        {
                            display: true,
                            labelString: 'Quantity of item requested',
                            fontSize: 14,
                        },

                        ticks:
                        {
                            beginAtZero:true,
                        }
                    },
                    {
                        id: "y-axis-2",
                        type: "linear", 
                        display: true,                             
                        position: "right",
                        gridLines: { drawOnChartArea: false },
                        scaleLabel:
                        {
                            display: true,
                            labelString: 'Cumulative Quantity',
                            fontSize: 14,
                        },

                        ticks:
                        {
                            beginAtZero:false,
                        }

                    }],

                    xAxes:
                    [{
                        scaleLabel:
                        {
                            display: true,
                            labelString: 'Months'
                        }
                    }]
                }
            }
    });
    


    // Define a plugin to provide data labels
    Chart.plugins.register({
        afterDatasetsDraw: function(chart, easing) {
            // To only draw at the end of animation, check for easing === 1
            var ctx = chart.ctx;

            chart.data.datasets.forEach(function (dataset, i) {
                var meta = chart.getDatasetMeta(i);
                if (!meta.hidden) {
                    meta.data.forEach(function(element, index) {
                        // Draw the text in black, with the specified font
                        ctx.fillStyle = 'rgb(0, 0, 0)';

                        var fontSize = 16;
                        var fontStyle = 'normal';
                        var fontFamily = 'Helvetica Neue';
                        ctx.font = Chart.helpers.fontString(fontSize, fontStyle, fontFamily);

                        // Just naively convert to string for now
                        var dataString = dataset.data[index].toString();

                        // Make sure alignment settings are correct
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';

                        var padding = 5;
                        var position = element.tooltipPosition();
                        ctx.fillText(dataString, position.x, position.y - (fontSize / 2) - padding);
                    });
                }
            });
        }
    });
</script>
